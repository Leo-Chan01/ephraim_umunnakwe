"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[805],{4805:function(e,t,r){r.d(t,{OQ:function(){return o},Ue:function(){return l}});let o=(0,r(1543).eI)("https://cecsvrwibdvncrxbbctr.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNlY3N2cndpYmR2bmNyeGJiY3RyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ1MjA3ODEsImV4cCI6MjA3MDA5Njc4MX0.dqSqaL37yCozA39pb61rnVzHmU0Jo_RH8vfisACAqS4"),a=!0,i=null;async function s(){try{let{error:e}=await o.from("projects").select("id").limit(1);if(e)throw e;return a=!0,i=null,!0}catch(e){return a=!1,i=e instanceof Error?e.message:"Unknown connection error",console.warn("Supabase connection failed:",e),!1}}let n={projects:[],testimonials:[],socialLinks:[],personalInfo:null},l={getConnectionStatus:()=>({isOnline:a,lastError:i}),retryConnection:async()=>await s(),async testStorageAccess(){try{let{data:e,error:t}=await o.storage.from("product_preview_images").list("",{limit:1});if(t)return console.error("Storage bucket access error:",t),!1;return console.log("Storage bucket accessible:",e),!0}catch(e){return console.error("Storage test failed:",e),!1}},async uploadProjectImage(e){try{if(!e)throw Error("No file provided");if(e.size>5242880)throw Error("File size must be less than 5MB");if(!e.type.startsWith("image/"))throw Error("File must be an image");let t=e.name.split(".").pop(),r="".concat(Date.now(),"-").concat(Math.random().toString(36).substring(2),".").concat(t),a="project-previews/".concat(r);console.log("Uploading file:",{fileName:r,fileSize:e.size,fileType:e.type});let{data:i,error:s}=await o.storage.from("product_preview_images").upload(a,e,{cacheControl:"3600",upsert:!1});if(s)throw console.error("Supabase storage error:",s),Error("Upload failed: ".concat(s.message));console.log("Upload successful:",i);let{data:n}=o.storage.from("product_preview_images").getPublicUrl(a);return console.log("Generated URL:",n.publicUrl),n.publicUrl}catch(e){throw console.error("Error uploading project image:",e),e}},async deleteProjectImage(e){try{let t=new URL(e).pathname.split("/").slice(-2).join("/"),{error:r}=await o.storage.from("product_preview_images").remove([t]);if(r)throw r}catch(e){console.error("Error deleting project image:",e)}},async getProjects(){try{a||await s();let{data:e,error:t}=await o.from("projects").select("*").order("created_at",{ascending:!1});if(t)return console.warn("Projects fetch error (possibly due to RLS):",t),n.projects;let r=e||[];return n.projects=r,a=!0,i=null,r}catch(e){return a=!1,i=e instanceof Error?e.message:"Failed to fetch projects",console.warn("Error fetching projects, using fallback:",e),n.projects}},async getTestimonials(){try{a||await s();let{data:e,error:t}=await o.from("testimonials").select("*").order("created_at",{ascending:!1});if(t)throw t;let r=e||[];return n.testimonials=r,a=!0,i=null,r}catch(e){return a=!1,i=e instanceof Error?e.message:"Failed to fetch testimonials",console.warn("Error fetching testimonials, using fallback:",e),n.testimonials}},async getSocialLinks(){try{a||await s();let{data:e,error:t}=await o.from("social_links").select("*").eq("is_visible",!0);if(t)throw t;let r=e||[];return n.socialLinks=r,a=!0,i=null,r}catch(e){return a=!1,i=e instanceof Error?e.message:"Failed to fetch social links",console.warn("Error fetching social links, using fallback:",e),n.socialLinks}},async getPersonalInfo(){try{a||await s();let{data:e,error:t}=await o.from("personal_info").select("*").limit(1).single();if(t)throw t;return n.personalInfo=e,a=!0,i=null,e}catch(e){return a=!1,i=e instanceof Error?e.message:"Failed to fetch personal info",console.warn("Error fetching personal info, using fallback:",e),n.personalInfo}},async loadAll(){console.log("Loading all portfolio data...");try{let e=await s(),[t,r,o,n]=await Promise.all([this.getProjects(),this.getTestimonials(),this.getSocialLinks(),this.getPersonalInfo()]);return console.log("Data loaded successfully. Online: ".concat(a)),{projects:t,testimonials:r,socialLinks:o,personalInfo:n,isOnline:e,...i&&{error:i}}}catch(t){let e=t instanceof Error?t.message:"Failed to load portfolio data";return console.error("Error loading portfolio data:",t),{projects:n.projects,testimonials:n.testimonials,socialLinks:n.socialLinks,personalInfo:n.personalInfo,isOnline:!1,error:e}}},subscribeToProjects(e){return o.channel("projects_changes").on("postgres_changes",{event:"*",schema:"public",table:"projects"},async()=>{try{let t=await this.getProjects();e(t)}catch(e){console.warn("Error in projects subscription:",e)}}).subscribe()},subscribeToTestimonials(e){return o.channel("testimonials_changes").on("postgres_changes",{event:"*",schema:"public",table:"testimonials"},async()=>{try{let t=await this.getTestimonials();e(t)}catch(e){console.warn("Error in testimonials subscription:",e)}}).subscribe()},async withRetry(e){let t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;for(let a=0;a<r;a++)try{return await e()}catch(e){if(t=e instanceof Error?e:Error("Unknown error"),a===r-1)throw t;await new Promise(e=>setTimeout(e,o*(a+1)))}throw t},async updatePersonalInfo(e){try{let t;await s();let{data:r}=await o.from("personal_info").select("id").limit(1).single();if(r){let{data:a,error:i}=await o.from("personal_info").update({name:e.name,title:e.title,email:e.email,phone:e.phone,location:e.location,bio:e.bio,profile_image_url:e.profile_image_url}).eq("id",r.id).select().single();if(i)throw i;t=a}else{let{data:r,error:a}=await o.from("personal_info").insert({name:e.name||"",title:e.title,email:e.email,phone:e.phone,location:e.location,bio:e.bio,profile_image_url:e.profile_image_url}).select().single();if(a)throw a;t=r}return t}catch(e){throw i=e instanceof Error?e.message:"Failed to update personal info",console.error("Error updating personal info:",e),e}},async updateSocialLinks(e){try{await s(),await o.from("social_links").delete().neq("platform","");let{data:t,error:r}=await o.from("social_links").insert(e.map(e=>({platform:e.platform,url:e.url,is_visible:e.is_visible}))).select();if(r)throw r;return t||[]}catch(e){throw i=e instanceof Error?e.message:"Failed to update social links",console.error("Error updating social links:",e),e}},async createSocialLink(e){try{await s();let{data:t,error:r}=await o.from("social_links").insert({platform:e.platform,url:e.url,is_visible:e.is_visible}).select().single();if(r)throw r;return t}catch(e){throw i=e instanceof Error?e.message:"Failed to create social link",console.error("Error creating social link:",e),e}},async updateSocialLink(e,t){try{await s();let{data:r,error:a}=await o.from("social_links").update({url:t.url,is_visible:t.is_visible}).eq("platform",e).select().single();if(a)throw a;return r}catch(e){throw i=e instanceof Error?e.message:"Failed to update social link",console.error("Error updating social link:",e),e}},async deleteSocialLink(e){try{await s();let{error:t}=await o.from("social_links").delete().eq("platform",e);if(t)throw t}catch(e){throw i=e instanceof Error?e.message:"Failed to delete social link",console.error("Error deleting social link:",e),e}},async saveProfile(e){try{let[t,r]=await Promise.all([this.updatePersonalInfo(e.personalInfo),this.updateSocialLinks(e.socialLinks)]);return{personalInfo:t,socialLinks:r}}catch(e){throw i=e instanceof Error?e.message:"Failed to save profile",console.error("Error saving profile:",e),e}},async createProject(e){try{await s();let{data:{user:t},error:r}=await o.auth.getUser();if(r||!t)throw Error("Authentication required to create projects");let{data:a,error:i}=await o.from("projects").insert({...e,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}).select().single();if(i)throw console.error("Supabase error details:",{message:i.message,details:i.details,hint:i.hint,code:i.code}),Error("Database error: ".concat(i.message).concat(i.details?" (Details: ".concat(i.details,")"):"").concat(i.hint?" (Hint: ".concat(i.hint,")"):""));return a}catch(t){console.error("Full error object:",t);let e=t instanceof Error?t.message:JSON.stringify(t);throw i=e,console.error("Error creating project:",e),Error(e)}},async updateProject(e,t){try{await s();let{data:{user:r},error:a}=await o.auth.getUser();if(a||!r)throw Error("Authentication required to update projects");let{data:i,error:n}=await o.from("projects").update({...t,updated_at:new Date().toISOString()}).eq("id",e).select().single();if(n)throw console.error("Supabase error details:",{message:n.message,details:n.details,hint:n.hint,code:n.code}),Error("Database error: ".concat(n.message).concat(n.details?" (Details: ".concat(n.details,")"):"").concat(n.hint?" (Hint: ".concat(n.hint,")"):""));return i}catch(t){console.error("Full error object:",t);let e=t instanceof Error?t.message:JSON.stringify(t);throw i=e,console.error("Error updating project:",e),Error(e)}},async deleteProject(e){try{await s();let{data:{user:t},error:r}=await o.auth.getUser();if(r||!t)throw Error("Authentication required to delete projects");let{error:a}=await o.from("projects").delete().eq("id",e);if(a)throw console.error("Supabase error details:",{message:a.message,details:a.details,hint:a.hint,code:a.code}),Error("Database error: ".concat(a.message).concat(a.details?" (Details: ".concat(a.details,")"):"").concat(a.hint?" (Hint: ".concat(a.hint,")"):""))}catch(t){console.error("Full error object:",t);let e=t instanceof Error?t.message:JSON.stringify(t);throw i=e,console.error("Error deleting project:",e),Error(e)}},async createTestimonial(e){try{await s();let{data:t,error:r}=await o.from("testimonials").insert({...e,created_at:new Date().toISOString()}).select().single();if(r)throw r;return t}catch(e){throw i=e instanceof Error?e.message:"Failed to create testimonial",console.error("Error creating testimonial:",e),e}},async updateTestimonial(e,t){try{await s();let{data:r,error:a}=await o.from("testimonials").update(t).eq("id",e).select().single();if(a)throw a;return r}catch(e){throw i=e instanceof Error?e.message:"Failed to update testimonial",console.error("Error updating testimonial:",e),e}},async deleteTestimonial(e){try{await s();let{error:t}=await o.from("testimonials").delete().eq("id",e);if(t)throw t}catch(e){throw i=e instanceof Error?e.message:"Failed to delete testimonial",console.error("Error deleting testimonial:",e),e}}}}}]);